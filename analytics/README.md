# Analytics Data Directory

This directory stores analytics data retrieved from Umami Analytics.

## Contents

- `umami_events.db` - SQLite database containing retrieved analytics data
- `summary_*.json` - Summary reports generated by the retrieval script

## Data Collection

Data is collected via the cron job script:

```bash
python scripts/retrieve_umami_analytics.py --days 7 --events --summary
```

## Database Schema

### Tables

**website_stats** - Overall website statistics
- pageviews, unique_visitors, visits, bounces, total_time

**events** - Individual event records
- event_name, event_url, event_data (JSON), event_timestamp

**url_metrics** - URL visit metrics
- url, visits

**event_metrics** - Event type metrics
- event_name, event_count

## Querying Data

Use Datasette to explore the analytics database:

```bash
datasette analytics/umami_events.db
```

Or query directly with SQL:

```sql
-- Top search queries
SELECT
    json_extract(event_data, '$.query_text') as search_term,
    json_extract(event_data, '$.subdomain') as municipality,
    COUNT(*) as search_count
FROM events
WHERE event_name = 'search_query'
GROUP BY search_term, municipality
ORDER BY search_count DESC
LIMIT 10;
```

## Privacy

- IP addresses are never stored in this database
- All data is aggregated analytics data from Umami
- Follows GDPR/CCPA best practices
