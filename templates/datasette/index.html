{% extends "base.html" %}

{% block title %}{{ site_title }}: {% for database in databases %}{{ database.name }}{% if not loop.last %}, {% endif %}{% endfor %}{% endblock %}

{% block extra_head %}
{% if noindex %}<meta name="robots" content="noindex">{% endif %}
{% endblock %}

{% block body_class %}index{% endblock %}

{% block content %}
<h1>{{ site_title }}{% if private %} üîí{% endif %}</h1>

{% set action_links, action_title = homepage_actions, "Homepage actions" %}
{% include "_action_menu.html" %}

{{ top_homepage() }}

{% if recent_activity or upcoming_agendas or recent_minutes %}
<div class="recent-content-section">
    <h2>Recent Activity</h2>
    
    {% if upcoming_agendas %}
    <div class="upcoming-meetings">
        <h3>üìÖ Upcoming Meetings</h3>
        <ul class="meeting-list">
        {% for agenda in upcoming_agendas %}
            <li class="meeting-item">
                <strong>{{ agenda.meeting.replace('Committee', ' Committee').replace('Council', ' Council') }}</strong>
                <span class="meeting-date">{{ agenda.date }}</span>
                <span class="meeting-pages">({{ agenda.pages }} pages)</span>
            </li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if recent_minutes %}
    <div class="recent-minutes">
        <h3>üìù Recently Published Minutes</h3>
        <ul class="meeting-list">
        {% for minutes in recent_minutes %}
            <li class="meeting-item">
                <strong>{{ minutes.meeting.replace('Committee', ' Committee').replace('Council', ' Council') }}</strong>
                <span class="meeting-date">{{ minutes.date }}</span>
                <span class="meeting-pages">({{ minutes.pages }} pages)</span>
                {% if minutes.preview %}
                <div class="meeting-preview">{{ minutes.preview|truncate(100) }}...</div>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if recent_activity %}
    <div class="recent-activity">
        <h3>üèõÔ∏è This Week's Activity</h3>
        <ul class="activity-list">
        {% for activity in recent_activity %}
            <li class="activity-item">
                <span class="activity-type">{{ activity.type|title }}</span>
                <strong>{{ activity.meeting.replace('Committee', ' Committee').replace('Council', ' Council') }}</strong>
                <span class="meeting-date">{{ activity.date }}</span>
                {% if activity.preview %}
                <div class="activity-preview">{{ activity.preview|truncate(80) }}...</div>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <div class="view-all-link">
        <a href="/meetings/agendas">View All Agendas</a> | 
        <a href="/meetings/minutes">View All Minutes</a> | 
        <a href="/-/dashboards/meetings-stats">Meeting Statistics</a>
    </div>
</div>

<style>
.recent-content-section {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1rem 0;
}

.recent-content-section h2 {
    color: #343a40;
    margin-bottom: 1rem;
    border-bottom: 2px solid #007bff;
    padding-bottom: 0.5rem;
}

.recent-content-section h3 {
    color: #495057;
    margin: 1rem 0 0.5rem 0;
    font-size: 1.1rem;
}

.meeting-list, .activity-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.meeting-item, .activity-item {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
}

.meeting-item:hover, .activity-item:hover {
    background: #f1f3f4;
}

.meeting-date {
    color: #6c757d;
    font-size: 0.9rem;
    margin-left: 0.5rem;
}

.meeting-pages {
    color: #6c757d;
    font-size: 0.8rem;
    margin-left: 0.5rem;
}

.meeting-preview, .activity-preview {
    color: #6c757d;
    font-size: 0.85rem;
    margin-top: 0.25rem;
    line-height: 1.3;
}

.activity-type {
    background: #007bff;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    font-size: 0.8rem;
    text-transform: uppercase;
    margin-right: 0.5rem;
}

.view-all-link {
    margin-top: 1rem;
    text-align: center;
    padding-top: 1rem;
    border-top: 1px solid #dee2e6;
}

.view-all-link a {
    color: #007bff;
    text-decoration: none;
    margin: 0 0.5rem;
}

.view-all-link a:hover {
    text-decoration: underline;
}
</style>
{% endif %}

{% if searchable_tables %}
    <form action="{{ urls.path("/-/search") }}" method="get">
        <p>
            <input type="search" name="q" value="{{ q }}" placeholder="Search for records across {{ searchable_tables|length }} table{% if searchable_tables|length > 1 %}s{% endif %}" id="search-all-q">
            <input type="submit" value="Search">
        </p>
    </form>
{% endif %}

{% for database in databases %}
    <h2 style="padding-left: 10px; border-left: 10px solid #{{ database.color }}"><a href="{{ urls.database(database.name) }}">{{ database.name }}</a>{% if database.private %} üîí{% endif %}</h2>
    <p>
        {% if database.show_table_row_counts %}{{ "{:,}".format(database.table_rows_sum) }} rows in {% endif %}{{ database.tables_count }} table{% if database.tables_count != 1 %}s{% endif %}{% if database.hidden_tables_count %}, {% endif -%}
        {% if database.hidden_tables_count -%}
            {% if database.show_table_row_counts %}{{ "{:,}".format(database.hidden_table_rows_sum) }} rows in {% endif %}{{ database.hidden_tables_count }} hidden table{% if database.hidden_tables_count != 1 %}s{% endif -%}
        {% endif -%}
        {% if database.views_count -%}
            {% if database.tables_count or database.hidden_tables_count %}, {% endif -%}
            {{ "{:,}".format(database.views_count) }} view{% if database.views_count != 1 %}s{% endif %}
        {% endif %}
    </p>
    <p>{% for table in database.tables_and_views_truncated %}<a href="{{ urls.table(database.name, table.name) }}"{% if table.count %} title="{{ table.count }} rows"{% endif %}>{{ table.name }}</a>{% if table.private %} üîí{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}{% if database.tables_and_views_more %}, <a href="{{ urls.database(database.name) }}">...</a>{% endif %}</p>
{% endfor %}
{% endblock %}

{% block description_source_license %}
<div class="metadata-description">
    <div class="message-info">
    <p>This is a fully searchable and queryable collection of minutes and agendas from {{ site_name }}</a>!</p>
    <ul class="bullets">
    <li><strong>See what's available here: <a href="/-/dashboards/meetings-stats">Meetings Statistics</a></strong></li>
    <li>See <a href="/meetings/upcoming">upcoming agendas</a></li>
    <li>Search agendas directly on the <a href="/meetings/agendas">agendas collection</a></li>
    <li>Search minutes directly on the <a href="/meetings/minutes">minutes collection</a></li>
    <li>Or search both below. If you need help, reach out to <a href="mailto:hello@civic.band">hello@civic.band</a>
    </ul>
    </div>
</div>

{% if site_description_html or site_description %}
    <div class="metadata-description">
        {% if site_description_html %}
            {{ site_description_html|safe }}
        {% else %}
            {{ description }}
        {% endif %}
    </div>
{% endif %}
{% endblock %}