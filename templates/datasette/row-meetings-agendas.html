{% extends "default:row.html" %}

{% block extra_head %}
<!-- Dublin Core metadata for citation tools -->
<meta name="DC.title" content="{{ rows[0].meeting }} {{ table|title }}, {{ rows[0].date }}">
<meta name="DC.creator" content="{{ site_name }}">
<meta name="DC.publisher" content="CivicBand Archive">
<meta name="DC.date" content="{{ rows[0].date }}">
<meta name="DC.type" content="Text">
<meta name="DC.format" content="text/html">
<meta name="DC.identifier" content="https://{{ subdomain }}.civic.band{{ request.path }}">
<meta name="DC.source" content="{{ site_name }}">
<meta name="DC.language" content="en">
{% endblock %}

{% block content %}
<h1 style="padding-left: 10px; border-left: 10px solid #{{ database_color }}">
    {{ table }}: {{ ', '.join(primary_key_values) }}{% if private %} ðŸ”’{% endif %}
</h1>

<a href="https://civic.observer/clip/?id={{ rows[0].id }}&subdomain={{ subdomain }}&table={{ table }}&utm_source=civicband&utm_medium=clip&utm_campaign={{ subdomain }}&utm_content=detail_button"
   class="clip-button"
   target="_blank"
   data-umami-event="clip_to_notebook"
   data-umami-event-table="{{ table }}">
    ðŸ“‹ Clip to Notebook
</a>

{% if rows and rows[0].page %}
<p style="margin: 0.5rem 0;">
    <a href="/{{ database }}/{{ table }}?meeting__exact={{ rows[0].meeting|urlencode }}&date__exact={{ rows[0].date|urlencode }}&page__gte={{ [rows[0].page - 2, 1]|max }}&page__lte={{ rows[0].page + 2 }}&_sort=page" data-umami-event="row_context" data-umami-event-table="agendas">View surrounding pages (pages {{ [rows[0].page - 2, 1]|max }}â€“{{ rows[0].page + 2 }})</a>
</p>
{% endif %}

{% if rows and rows[0].meeting and rows[0].date %}
<details class="cite-this">
    <summary>Cite this page</summary>
    <div class="cite-content">
        <p class="citation-text" id="citation-agendas-{{ primary_key_values[0] }}">
            {{ site_name }}. "{{ rows[0].meeting }} {{ table|title }}." {{ rows[0].date }}, page {{ rows[0].page }}. CivicBand Archive. Accessed <span class="access-date"></span>. https://{{ subdomain }}.civic.band{{ request.path }}
        </p>
        <button class="copy-citation" onclick="navigator.clipboard.writeText(document.getElementById('citation-agendas-{{ primary_key_values[0] }}').textContent.trim()).then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy citation', 2000); })">Copy citation</button>
    </div>
</details>
<script>
document.querySelector('#citation-agendas-{{ primary_key_values[0] }} .access-date').textContent =
    new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
</script>
{% endif %}

{% set action_links, action_title = row_actions, "Row actions" %}
{% include "_action_menu.html" %}

{{ top_row() }}

{% block description_source_license %}{% include "_description_source_license.html" %}{% endblock %}

<p>This data as {% for name, url in renderers.items() %}<a href="{{ url }}">{{ name }}</a>{{ ", " if not loop.last }}{% endfor %}</p>

{% include custom_table_templates %}

{% if foreign_key_tables %}
    <h2>Links from other tables</h2>
    <ul>
        {% for other in foreign_key_tables %}
            <li>
                <a href="{{ other.link }}">
                    {{ "{:,}".format(other.count) }} row{% if other.count == 1 %}{% else %}s{% endif %}</a>
                from {{ other.other_column }} in {{ other.other_table }}
            </li>
        {% endfor %}
    </ul>
{% endif %}

<style>
.cite-this {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    margin: 0.75rem 0;
    font-size: 0.9rem;
}

.cite-this summary {
    cursor: pointer;
    font-weight: 500;
    color: #495057;
}

.cite-this[open] summary {
    margin-bottom: 0.5rem;
}

.cite-content {
    padding: 0.5rem 0;
}

.citation-text {
    background: #fff;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 0.75rem;
    margin: 0 0 0.5rem 0;
    font-family: Georgia, serif;
    line-height: 1.5;
}

.copy-citation {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 0.4rem 0.75rem;
    font-size: 0.85rem;
    cursor: pointer;
}

.copy-citation:hover {
    background: #0056b3;
}

a.clip-button,
a.clip-button:link,
a.clip-button:visited {
    display: inline-block;
    background: #28a745;
    color: white !important;
    text-decoration: none;
    border-radius: 4px;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    margin: 0.5rem 0;
}

a.clip-button:hover,
a.clip-button:active {
    background: #218838;
    color: white !important;
}
</style>
{% endblock %}
