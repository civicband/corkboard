<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
  <!-- Table Column -->
  <div class="lg:col-span-2">
    {% if sites %}
      {% if query %}
      <div class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-t text-sm text-gray-600">
        Showing {{ visible_count }} of {{ total_count }} sites
      </div>
      {% endif %}

      <div class="overflow-x-auto border border-gray-200 rounded{% if not query %} rounded-t{% endif %}">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                Municipality
              </th>
              <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                State
              </th>
              <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                Type
              </th>
              <th scope="col" class="px-3 py-2 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">
                Pages
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for site in sites %}
            <tr class="hover:bg-gray-50 transition">
              <td class="px-3 py-2 whitespace-nowrap">
                <a href="https://{{ site.subdomain }}.civic.band"
                   class="text-indigo-600 hover:text-indigo-900 font-medium"
                   data-umami-event="homepage_muni"
                   data-umami-event-subdomain="{{ site.subdomain }}">
                  {{ site.name }}
                </a>
              </td>
              <td class="px-3 py-2 whitespace-nowrap text-gray-600">
                {{ site.state }}
              </td>
              <td class="px-3 py-2 whitespace-nowrap text-gray-600 capitalize">
                {{ site.kind }}
              </td>
              <td class="px-3 py-2 whitespace-nowrap text-right text-gray-600">
                {% load humanize %}{{ site.pages|intcomma }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="px-6 py-12 text-center border border-gray-200 rounded">
        <p class="text-gray-500">No municipalities match your search.</p>
        <p class="text-sm text-gray-400 mt-2">Try adjusting your filters</p>
      </div>
    {% endif %}
  </div>

  <!-- Map Column -->
  <div class="lg:col-span-1">
    <div id="sites-map" class="h-64 lg:h-[600px] rounded border border-gray-200 lg:sticky lg:top-4"></div>
  </div>
</div>

{% include 'pages/_map_data.html' %}
